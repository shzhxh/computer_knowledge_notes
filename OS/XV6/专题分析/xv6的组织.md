操作系统有三个需求：多路复用、隔离和交互。本章概述了操作系统如何实现如上三个需求，本章还概述了xv6的进程。xv6-riscv在低层的实现很多是特定于riscv的，比如进程。

#### 抽象物理资源

把物理资源抽象成系统调用接口，可以简化应用程序的编写，并使应用程序相互隔离，实践证明是个比较好的硬件抽象方法。

#### 特权模式和系统调用

应用程序处于用户模式，以被强制隔离。内核处于管理模式，以执行特权指令。CPU从机器模式开始执行，主要是配置计算机。

应用程序通过ecall指令调用内核的功能。应用程序不应知道调用内核功能的内存地址，因为恶意程序可借此威胁系统安全。

#### 内核的组织

操作系统的哪一部分放在管理模式下是设计的一个核心问题，宏内核的设计是把整个操作系统都放在内核里。这样的内核组织方式使得操作系统拥有完整的硬件权限，这有利于操作系统的不同部分间相互协同。但这也使操作系统的不同部分之间的接口变得复杂，从而出容易出现错误。为了减少内核产生错误的风险，仅让少量的操作系统代码运行在管理模式，而让大部分的操作系统都运行在用户模式，这样的内核组织方式叫微内核。

在微内核里，操作系统的大量功能都以服务的形式运行于用户态，其它程序以进程间通信的方式使用操作系统提供的服务。这样内核接口就仅包含少量的低级别的功能，诸如启动程序、发送消息、访问硬件等。

#### xv6的组织

#### 进程概述

#### 第一个进程

加电后先完成初始化，然后运行ROM里的bootloader，bootloader再把xv6内核载入内存。然后从xv6内核的`_entry`开始执行。
内核被加载到0x80000000处，之所以不加载到0x0处是因为在0x0:0x80000000之间包含了I/O设备。
`_entry`标记的作用是为C代码的运行指定栈，然后就跳转到`start`标记执行C代码。
`start`标记的作用是进行一些配置，这些配置只能在机器模式下来做，然后就切换到管理模式从`main`函数开始执行。`start`函数做了两件事，为切换到管理模式做好准备，初始化计时器中断。
`main`函数首先是初始化了一些设备和子系统，然后调用`userinit`来创建第一个进程。第一个进程执行了一个小程序`initcode.S`，通过系统调用`exec`执行一个新的程序`/init`。`/init`创建了一个控制台设备文件，并作为文件描述符0，1，2来打开它。然后在无限循环中，启动shell并处理僵尸进程。系统就这样启动了。