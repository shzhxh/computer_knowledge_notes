#### 硬盘控制器和硬盘的接口

假设硬盘有1024个扇区，每个扇区512字节。从硬盘传到硬盘控制器的实际是比特流，这个比特流以**前导符**(preamble)开始，然后是扇区里的4906个比特，最后是一个检验和（也被叫做**纠错码**，ECC）。前导符是在硬盘格式化的时候写入的，包含了柱面号、扇区号、扇区大小这样的信息。

控制器把这串比特流转换了字节块，进行必要的纠错。先在控制器里逐位汇集成块，然后进行检验和的验证，最后把块复制进内存。

现代磁盘控制器通常在控制器内部有许多兆字节的内存。因此，当一个读取被处理时，只要臂到达正确的圆柱体，控制器就开始读取和存储数据，即使它还没有到达它需要的扇区。这些缓存的数据在满足后续请求时可能会派上用场。此外，即使获得了请求的数据，控制器也可能继续缓存来自后续扇区的数据，因为它们可能稍后需要。通过这种方式，可以在没有任何磁盘活动的情况下处理许多磁盘读取操作。

磁盘控制器为什么需要内部的缓冲区呢？有两个原因。

一，通过内部缓冲，磁盘控制器可以在开始传输之前验证校验和。如果校验和不正确，就会发出错误信号，并且不会向内存传输数据。

二，一旦磁盘传输开始，无论控制器是否准备好，比特都会以恒定的速度从磁盘到达。如果控制器试图直接将数据写入内存，它将不得不通过系统总线查找传输的每个字。如果总线由于使用它的其他设备而繁忙，控制器将不得不等待。如果下一个磁盘字在前一个磁盘字存储之前到达，控制器就必须把它存储在某个地方。如果总线非常繁忙，控制器最终可能会存储相当多的字，并有很多管理工作要做。当块在内部进行缓冲时，如果DMA没开始则不需要总线，因此控制器的设计要简单得多，因为DMA传输到内存的时间没有严格要求。

#### 硬盘控制器

（ide控制器最多支持4个硬盘）

	0x1f0:读数据，注：应该是4字节大的端口
	0x1f2:需要读写的扇区数量
	0x1f3:LBA参数的0～7位		//LBA参数即要读写扇区的起始扇区号
	0x1f4:LBA参数的8～15位
	0x1f5:LBA参数的16～23位
	0x1f6:0～3（LBA24～27位），4（0主盘1从盘），6（1LBA模式，0CHS模式），5和7（固定为1）
	0x1f7:状态和命令寄存器
		0x20命令读取硬盘
		第7位为1表示硬盘忙
		第7位为0,第3位为1表示硬盘空闲，可以读取指令
